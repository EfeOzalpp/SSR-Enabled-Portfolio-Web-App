"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[377],{15250:(e,t,n)=>{n.r(t),n.d(t,{default:()=>k});var r=n(31014),o=n(21751),l=n(4137),a=n(9381),s=n.n(a),i=n(43431),c=n(32247),u=n(46550);const d=e=>{let{onClick:t,onMount:n,onUnmount:o,startAtFrame:l=0,loopFromFrame:a=41,debug:d=!1,label:m="Click Here to Play!",ctaEnabled:g=!1,loadingLines:v=["Loading engine\u2026","Creating game canvas\u2026","Configuring frame loop\u2026","Setting up input controls\u2026","Applying display settings\u2026","Initializing game state\u2026","Spawning player\u2026","Almost ready\u2026"]}=e;const p=(0,r.useRef)(null),f=(0,r.useRef)(null),y=(0,r.useRef)("intro"),b=(0,r.useRef)(!1),h=(0,r.useRef)(0),E=(0,r.useRef)(n),L=(0,r.useRef)(o);(0,r.useEffect)(()=>{E.current=n},[n]),(0,r.useEffect)(()=>{L.current=o},[o]);const S=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return d&&console.log("[Coin]",...t)};return(0,r.useEffect)(()=>{var e;null===(e=E.current)||void 0===e||e.call(E);const t=p.current;if(!t)return()=>{var e;return null===(e=L.current)||void 0===e?void 0:e.call(L)};try{var n;null===(n=f.current)||void 0===n||n.destroy()}catch(d){}f.current=null,y.current="intro",b.current=!1;const r=s().loadAnimation({container:t,renderer:"svg",loop:!1,autoplay:!1,animationData:i,rendererSettings:{preserveAspectRatio:"xMidYMid meet",progressiveLoad:!0}});f.current=r;const o=()=>{h.current=(()=>{var e,t,n,o;return Math.max(1,Math.floor(null!==(e=null!==(t=null===(n=(o=r).getDuration)||void 0===n?void 0:n.call(o,!0))&&void 0!==t?t:r.totalFrames)&&void 0!==e?e:1))-1})(),S("DOMLoaded",{absEnd:h.current}),(()=>{const e=h.current,t=Math.max(0,Math.min(l,e));S("intro start",{startAtFrame:t,absEnd:e}),r.goToAndStop(t,!0),r.playSegments([t,e],!0)})()},c=()=>{b.current||(b.current=!0,S("intro complete",{frame:Math.floor(r.currentFrame||0)}),(()=>{if("tail"===y.current)return;y.current="tail";const e=h.current,t=Math.max(0,Math.min(a,e));r.removeEventListener("complete",c),r.loop=!0,r.playSegments([t,e],!0),S("\u2192 tail loop",{tailStart:t,absEnd:e})})())},u=()=>{"tail"===y.current&&S("loopComplete (tail)",{frame:Math.floor(r.currentFrame||0)})};return r.addEventListener("DOMLoaded",o),r.addEventListener("complete",c),r.addEventListener("loopComplete",u),()=>{var e;S("destroy");try{r.removeEventListener("DOMLoaded",o),r.removeEventListener("complete",c),r.removeEventListener("loopComplete",u),r.destroy()}catch(t){}f.current=null,null===(e=L.current)||void 0===e||e.call(L)}},[l,a,d]),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{ref:p,className:"coin",onClick:t,style:{pointerEvents:"auto"}}),g?(0,u.jsx)("h1",{className:"onboarding-text",onClick:t,style:{pointerEvents:"auto"},children:m}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("h1",{className:"onboarding-text loading-text",style:{pointerEvents:"none"},children:"Loading Game\u2026"}),(0,u.jsx)(c.A,{className:"loading-hub--game loading-hub--left",keyword:"game",minHeight:72,lines:v,ariaLabel:"Loading game"})]})]})};var m=n(75685),g=n(17869),v=n(61460),p=n(53451),f=n(8786),y=n(88207),b=n(76585),h=n(41195),E=n(18828),L=n(91426),S=n(46431);const x="game-mode-active";const A=e=>{let{reset:t,startAtFrame:n,onInnerMount:r,label:o,ctaEnabled:l,loadingLines:a}=e;return(0,u.jsx)(d,{startAtFrame:n,onMount:r,label:o,ctaEnabled:l,loadingLines:a},t)},k=()=>{const[e,t]=(0,r.useState)(null),[n,l]=(0,r.useState)(null),[a,s]=(0,r.useState)(null),[i,c]=(0,r.useState)(!1),[d,m]=(0,r.useState)(!1),g=(0,r.useRef)(!1),v=(0,r.useRef)(!1),p=(0,r.useRef)(!1),[f,y]=(0,r.useState)(0),b=(0,r.useCallback)(()=>y(e=>e+1),[]),h=(0,r.useMemo)(()=>g.current?0:30,[f]),E=(0,r.useCallback)(()=>{g.current=!0},[]);return(0,r.useEffect)(()=>{const e=document.getElementById("block-game");if(!e)return;t(e);const n=e.querySelector('[data-ssr-shell="block-game"]');if(!n)return;let r=n.querySelector(".block-g-onboarding");var o,a;r||(r=n,r.classList.add("block-g-onboarding","tooltip-block-g"),r.setAttribute("aria-live","polite"),(o=r.style).display||(o.display="flex"),(a=r.style).alignItems||(a.alignItems="center"));r.replaceChildren(),l(r),s(n)},[]),(0,r.useEffect)(()=>{if(!e)return;const t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3;const n=window;if("function"===typeof n.requestIdleCallback){const r=n.requestIdleCallback(e,{timeout:t});return()=>{var e;return null===(e=n.cancelIdleCallback)||void 0===e?void 0:e.call(n,r)}}const r=window.setTimeout(e,t);return()=>window.clearTimeout(r)}(()=>c(!0),2e3),n=new IntersectionObserver(e=>{let[r]=e;r.isIntersecting&&(c(!0),t(),n.disconnect())},{threshold:[0,.3]});return n.observe(e),()=>{n.disconnect(),t()}},[e]),(0,r.useEffect)(()=>{if(!e)return;const t=new IntersectionObserver(t=>{let[n]=t;const r=!!n.isIntersecting;if(!v.current)return v.current=!0,void(p.current=r);const o=p.current;p.current=r,!r||o||e.classList.contains("ingame")||y(e=>e+1)},{threshold:.01});return t.observe(e),()=>t.disconnect()},[e]),e&&n&&a&&i?(0,u.jsxs)(u.Fragment,{children:[(0,o.createPortal)((0,u.jsx)(A,{reset:f,startAtFrame:h,onInnerMount:E,label:d?"Click Here to Play!":"Loading Game\u2026",ctaEnabled:d}),n),(0,o.createPortal)((0,u.jsx)(M,{container:e,onboardingEl:n,reapplyOnboarding:b,isStageReady:d,onStageReady:m}),a)]}):null},M=e=>{let{container:t,onboardingEl:o,reapplyOnboarding:a,isStageReady:s,onStageReady:i}=e;const c=(0,p.e)(),[d,A]=(0,r.useState)(!1),[k,M]=(0,r.useState)(0),[w,C]=(0,r.useState)(null),I=(0,b.t)(),j="number"===typeof I?I:0,O=(null==w?k:w)>j?null==w?k:w:j,R=null==w&&k>j,[F,T]=(0,r.useState)(null),[D,_]=(0,r.useState)(!1),[H,N]=(0,r.useState)(!1),q=(0,r.useRef)(null),B=(0,r.useRef)(null),P=(0,r.useCallback)(()=>{s&&(y.nJ.game(),t.classList.add("ingame"),document.body.classList.add(x),A(!0),M(0),C(null),T("lottie"),o.style.transition="opacity 180ms ease",o.style.opacity="0",window.setTimeout(()=>{o.style.display="none"},180))},[t,o,s]);(0,r.useEffect)(()=>{const e=".coin, .onboarding-text, [data-start-hit]",t=()=>{o.querySelectorAll(e).forEach(e=>{const t=e;t.style.pointerEvents=s?"auto":"none",t.style.cursor=s?"pointer":"default",t.hasAttribute("role")||t.setAttribute("role","button"),t.tabIndex<0&&(t.tabIndex=0)}),o.setAttribute("aria-busy",String(!s))};t();const n=new MutationObserver(t);n.observe(o,{childList:!0,subtree:!0});const r=t=>{if(!s)return;const n=t.target;n&&n.closest(e)&&P()},l=t=>{if(s&&("Enter"===t.key||" "===t.key)){const n=t.target;n&&n.closest(e)&&(t.preventDefault(),P())}};return o.addEventListener("click",r,{passive:!0}),o.addEventListener("keydown",l),()=>{n.disconnect(),o.removeEventListener("click",r),o.removeEventListener("keydown",l)}},[o,P,s]),(0,r.useEffect)(()=>{if("lottie"!==F||!q.current)return;let e,t=!0;return(async()=>{if(e=await l.A.loadAnimation({container:q.current,renderer:"svg",loop:!1,autoplay:!0,animationData:c?L:E}),!t||!e)return;const n=()=>T("begin");e.addEventListener("complete",n)})(),()=>{var n,r;t=!1,null===(n=e)||void 0===n||null===(r=n.destroy)||void 0===r||r.call(n)}},[F,c]),(0,r.useEffect)(()=>{if("begin"===F){const e=setTimeout(()=>T(null),1e3);return()=>clearTimeout(e)}},[F]),(0,r.useEffect)(()=>{if("lottie"===F)_(!0),N(!0);else if(null===F){_(!1);const e=setTimeout(()=>N(!1),400);return()=>clearTimeout(e)}},[F]);const G=e=>{B.current=e,i(!0)};(0,r.useEffect)(()=>()=>i(!1),[i]);return(0,u.jsxs)(u.Fragment,{children:[!d&&(0,u.jsx)(f.A,{load:()=>n.e(874).then(n.bind(n,66874)),fallback:null,preloadOnIdle:!0,preloadIdleTimeout:2e3,preloadOnFirstIO:!0,rootMargin:"0px",placeholderMinHeight:360,componentProps:{onReady:G,onCoinsChange:e=>M(e),onGameOver:e=>C(e),highScore:j,pauseWhenHidden:!0,demoMode:!0,overlayActive:!1,allowSpawns:!0}}),d&&(0,u.jsxs)(S.A,{children:[(0,u.jsx)(h.A,{active:!0,lockBodyScroll:!0,alsoBlockWheel:!0,alsoBlockTouch:!0,allowWhenTyping:!0}),(0,u.jsx)(m.A,{onExit:()=>{A(!1),T(null),M(0),C(null),document.body.classList.remove(x),t.classList.remove("ingame"),o.style.display="",a(),requestAnimationFrame(()=>{o.style.opacity="1"})}}),(0,u.jsx)(g.A,{coins:k,highScore:O,newHighScore:R}),H&&(0,u.jsx)("div",{className:"countdown-bg-overlay ".concat(D?"":"hide"),style:{pointerEvents:"none"}}),("lottie"===F||"begin"===F)&&(0,u.jsx)("div",{ref:q,id:"lottie-onboarding",className:"countdown-lottie",style:{pointerEvents:"none"}}),(0,u.jsx)(v.A,{score:w,highScore:j,onRestart:()=>{var e;t.classList.add("ingame"),T(null),M(0),C(null),null===(e=B.current)||void 0===e||e.restart()},onHide:()=>C(null)}),(0,u.jsx)(f.A,{load:()=>n.e(874).then(n.bind(n,66874)),fallback:null,mountMode:"io",observeTargetId:"game-viewport-root",rootMargin:"0px",enterThreshold:.01,exitThreshold:0,unmountDelayMs:150,preloadOnIdle:!0,preloadIdleTimeout:2e3,preloadOnFirstIO:!0,placeholderMinHeight:360,componentProps:{onReady:G,onCoinsChange:e=>M(e),onGameOver:e=>C(e),highScore:j,pauseWhenHidden:!0,demoMode:!1,overlayActive:"lottie"===F||"begin"===F,allowSpawns:"begin"===F||null===F}})]})]})}}}]);
//# sourceMappingURL=377.ee585db0.chunk.js.map