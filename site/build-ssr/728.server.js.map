{"version":3,"file":"728.server.js","mappings":"2KAOe,SAASA,IACtB,MAAOC,EAAMC,IAAWC,EAAAA,EAAAA,UAA6B,OAC9CC,EAAOC,IAAYF,EAAAA,EAAAA,UAAS,IAAOG,OAAOC,WAAa,IAAM,GAAK,KAClEC,EAAYC,IAAiBN,EAAAA,EAAAA,UAASG,OAAOI,YAAcJ,OAAOC,YA6FzE,OA3FAI,EAAAA,EAAAA,MAEAC,EAAAA,EAAAA,WAAU,KACR,MAAMC,EAA6B,GAEnCC,SAASC,eAAe,cAAcC,UAAUC,OAAO,qBAEvD,MAAMC,EAASJ,SAASK,cAAc,gCAChCC,EAASN,SAASK,cAAc,gCAEhCE,EAAQH,GAAQI,SAASC,QACzBC,EAAQJ,GAAQE,SAASC,QAQ/B,GALIL,GAAUG,GAASH,EAAOO,MAAQJ,IACpCH,EAAOO,IAAMJ,GAIXD,EAAQ,CACNI,GAASJ,EAAOM,SAAWF,IAC7BJ,EAAOM,OAASF,GAGlB,MAAMG,EAAeA,KACnBP,EAAOQ,gBAAgB,WAGnBC,EAASA,KACb,MAAMC,EAAOV,EACb,GAA8C,mBAAnCU,EAAKC,0BACdD,EAAKC,0BAA0B,IAAMJ,SAChC,CACL,MAAMK,EAASA,KACTZ,EAAOa,YAAc,GAAKb,EAAOc,YAAc,IACjDd,EAAOe,oBAAoB,aAAcH,GACzCL,MAGJP,EAAOgB,iBAAiB,aAAcJ,EAAQ,CAAEK,MAAM,IACtDxB,EAAQyB,KAAK,IAAMlB,EAAOe,oBAAoB,aAAcH,IAE5D,MAAMO,EAAQC,WAAW,KACvBpB,EAAOe,oBAAoB,aAAcH,GACzCL,KACC,MACHd,EAAQyB,KAAK,IAAMG,aAAaF,GAClC,GAMF,GAHAnB,EAAOgB,iBAAiB,OAAQP,EAAQ,CAAEQ,MAAM,IAChDxB,EAAQyB,KAAK,IAAMlB,EAAOe,oBAAoB,OAAQN,IAE5B,IAAtBT,EAAOc,WAAkB,CAC3Bd,EAAOsB,QAAU,OACjB,IAAMtB,EAAOuB,MAAQ,CAAE,MAAO,CAChC,MACEvB,EAAOsB,QAAU,OAGnBtB,EAAOwB,OAAOC,MAAM,OACtB,CAEA3C,EAAQY,SAASC,eAAe,0BAEhC+B,EAAAA,EAAAA,IAAgB1C,EAAOI,EAAY,CACjCuC,GAAI,0BACJC,GAAI,4BAGN,MAAMC,EAAWA,KACf,MAAMC,EAAI5C,OAAOI,YAAcJ,OAAOC,WACtCE,EAAcyC,IACdJ,EAAAA,EAAAA,IAAgB1C,EAAO8C,EAAG,CACxBH,GAAI,0BACJC,GAAI,6BAMR,OAHA1C,OAAO8B,iBAAiB,SAAUa,EAAU,CAAEE,SAAS,IACvDtC,EAAQyB,KAAK,IAAMhC,OAAO6B,oBAAoB,SAAUc,IAEjD,IAAMpC,EAAQuC,QAAQC,GAAMA,MAClC,KAEHzC,EAAAA,EAAAA,WAAU,MACRkC,EAAAA,EAAAA,IAAgB1C,EAAOI,EAAY,CACjCuC,GAAI,0BACJC,GAAI,6BAEL,CAAC5C,EAAOI,IAENP,GACEqD,EAAAA,EAAAA,eACLC,EAAAA,EAAAA,GAACC,EAAAA,EAAgB,CACfpD,MAAOA,EACPC,SAAUA,EACVoD,IAAK,CAAEV,GAAI,0BAA2BC,GAAI,6BAE5C/C,GAPgB,IASpB,C","sources":["webpack://personal-site/./src/ssr/projects/scoop.enhancer.tsx"],"sourcesContent":["// src/ssr/projects/scoop.enhancer.tsx\r\nimport { useEffect, useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport SplitDragHandler from '../../utils/split+drag/split-controller';\r\nimport { useTooltipInit } from '../../utils/tooltip/tooltipInit';\r\nimport { applySplitStyle } from '../logic/apply-split-style';\r\n\r\nexport default function ScoopEnhancer() {\r\n  const [host, setHost] = useState<HTMLElement | null>(null);\r\n  const [split, setSplit] = useState(() => (window.innerWidth < 768 ? 55 : 50));\r\n  const [isPortrait, setIsPortrait] = useState(window.innerHeight > window.innerWidth);\r\n\r\n  useTooltipInit();\r\n\r\n  useEffect(() => {\r\n    const cleanup: Array<() => void> = [];\r\n\r\n    document.getElementById('scoop-ssr')?.classList.remove('ssr-initial-split');\r\n\r\n    const img1El = document.querySelector('#scoop-ssr #icecream-media-1') as HTMLImageElement | null;\r\n    const vid2El = document.querySelector('#scoop-ssr #icecream-media-2') as HTMLVideoElement | null;\r\n\r\n    const full1 = img1El?.dataset?.srcFull;\r\n    const full2 = vid2El?.dataset?.srcFull;\r\n\r\n    // Upgrade LEFT media (image)\r\n    if (img1El && full1 && img1El.src !== full1) {\r\n      img1El.src = full1;\r\n    }\r\n\r\n    // Upgrade RIGHT media (video)\r\n    if (vid2El) {\r\n      if (full2 && vid2El.poster !== full2) {\r\n        vid2El.poster = full2;\r\n      }\r\n\r\n      const removePoster = () => {\r\n        vid2El.removeAttribute('poster');\r\n      };\r\n\r\n      const onPlay = () => {\r\n        const anyV = vid2El as any;\r\n        if (typeof anyV.requestVideoFrameCallback === 'function') {\r\n          anyV.requestVideoFrameCallback(() => removePoster());\r\n        } else {\r\n          const onTime = () => {\r\n            if (vid2El.currentTime > 0 && vid2El.readyState >= 2) {\r\n              vid2El.removeEventListener('timeupdate', onTime);\r\n              removePoster();\r\n            }\r\n          };\r\n          vid2El.addEventListener('timeupdate', onTime, { once: true });\r\n          cleanup.push(() => vid2El.removeEventListener('timeupdate', onTime));\r\n\r\n          const timer = setTimeout(() => {\r\n            vid2El.removeEventListener('timeupdate', onTime);\r\n            removePoster();\r\n          }, 1200);\r\n          cleanup.push(() => clearTimeout(timer));\r\n        }\r\n      };\r\n\r\n      vid2El.addEventListener('play', onPlay, { once: true });\r\n      cleanup.push(() => vid2El.removeEventListener('play', onPlay));\r\n\r\n      if (vid2El.readyState === 0) {\r\n        vid2El.preload = 'auto';\r\n        try { vid2El.load(); } catch {}\r\n      } else {\r\n        vid2El.preload = 'auto';\r\n      }\r\n\r\n      vid2El.play().catch(() => { /* ignored; poster remains until user interacts */ });\r\n    }\r\n\r\n    setHost(document.getElementById('scoop-enhancer-mount'));\r\n\r\n    applySplitStyle(split, isPortrait, {\r\n      m1: 'scoop-media-1-container',\r\n      m2: 'scoop-media-2-container',\r\n    });\r\n\r\n    const onResize = () => {\r\n      const p = window.innerHeight > window.innerWidth;\r\n      setIsPortrait(p);\r\n      applySplitStyle(split, p, {\r\n        m1: 'scoop-media-1-container',\r\n        m2: 'scoop-media-2-container',\r\n      });\r\n    };\r\n    window.addEventListener('resize', onResize, { passive: true });\r\n    cleanup.push(() => window.removeEventListener('resize', onResize));\r\n\r\n    return () => cleanup.forEach(fn => fn());\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    applySplitStyle(split, isPortrait, {\r\n      m1: 'scoop-media-1-container',\r\n      m2: 'scoop-media-2-container',\r\n    });\r\n  }, [split, isPortrait]);\r\n\r\n  if (!host) return null;\r\n  return createPortal(\r\n    <SplitDragHandler\r\n      split={split}\r\n      setSplit={setSplit}\r\n      ids={{ m1: 'scoop-media-1-container', m2: 'scoop-media-2-container' }}\r\n    />,\r\n    host\r\n  );\r\n}\r\n"],"names":["ScoopEnhancer","host","setHost","useState","split","setSplit","window","innerWidth","isPortrait","setIsPortrait","innerHeight","useTooltipInit","useEffect","cleanup","document","getElementById","classList","remove","img1El","querySelector","vid2El","full1","dataset","srcFull","full2","src","poster","removePoster","removeAttribute","onPlay","anyV","requestVideoFrameCallback","onTime","currentTime","readyState","removeEventListener","addEventListener","once","push","timer","setTimeout","clearTimeout","preload","load","play","catch","applySplitStyle","m1","m2","onResize","p","passive","forEach","fn","createPortal","_jsx","SplitDragHandler","ids"],"sourceRoot":""}