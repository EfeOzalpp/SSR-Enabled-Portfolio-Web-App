"use strict";exports.id=167,exports.ids=[167],exports.modules={5167:(e,t,n)=>{n.r(t),n.d(t,{default:()=>M});var r=n(2015),o=n(2326),a=n(64),l=n(6052),s=n.n(l),i=n(3431),c=n(9803),u=n(6442);const d=({onClick:e,onMount:t,onUnmount:n,startAtFrame:o=0,loopFromFrame:a=41,debug:l=!1,label:d="Click Here to Play!",ctaEnabled:m=!1,loadingLines:g=["Loading engine…","Creating game canvas…","Configuring frame loop…","Setting up input controls…","Applying display settings…","Initializing game state…","Spawning player…","Almost ready…"]})=>{const p=(0,r.useRef)(null),f=(0,r.useRef)(null),b=(0,r.useRef)("intro"),y=(0,r.useRef)(!1),h=(0,r.useRef)(0),v=(0,r.useRef)(t),E=(0,r.useRef)(n);(0,r.useEffect)(()=>{v.current=t},[t]),(0,r.useEffect)(()=>{E.current=n},[n]);const S=(...e)=>l&&console.log("[Coin]",...e);return(0,r.useEffect)(()=>{v.current?.();const e=p.current;if(!e)return()=>E.current?.();try{f.current?.destroy()}catch{}f.current=null,b.current="intro",y.current=!1;const t=s().loadAnimation({container:e,renderer:"svg",loop:!1,autoplay:!1,animationData:i,rendererSettings:{preserveAspectRatio:"xMidYMid meet",progressiveLoad:!0}});f.current=t;const n=()=>{h.current=Math.max(1,Math.floor(t.getDuration?.(!0)??t.totalFrames??1))-1,S("DOMLoaded",{absEnd:h.current}),(()=>{const e=h.current,n=Math.max(0,Math.min(o,e));S("intro start",{startAtFrame:n,absEnd:e}),t.goToAndStop(n,!0),t.playSegments([n,e],!0)})()},r=()=>{y.current||(y.current=!0,S("intro complete",{frame:Math.floor(t.currentFrame||0)}),(()=>{if("tail"===b.current)return;b.current="tail";const e=h.current,n=Math.max(0,Math.min(a,e));t.removeEventListener("complete",r),t.loop=!0,t.playSegments([n,e],!0),S("→ tail loop",{tailStart:n,absEnd:e})})())},l=()=>{"tail"===b.current&&S("loopComplete (tail)",{frame:Math.floor(t.currentFrame||0)})};return t.addEventListener("DOMLoaded",n),t.addEventListener("complete",r),t.addEventListener("loopComplete",l),()=>{S("destroy");try{t.removeEventListener("DOMLoaded",n),t.removeEventListener("complete",r),t.removeEventListener("loopComplete",l),t.destroy()}catch{}f.current=null,E.current?.()}},[o,a,l]),(0,u.FD)(u.FK,{children:[(0,u.Y)("div",{ref:p,className:"coin",onClick:e,style:{pointerEvents:"auto"}}),m?(0,u.Y)("h1",{className:"onboarding-text",onClick:e,style:{pointerEvents:"auto"},children:d}):(0,u.FD)(u.FK,{children:[(0,u.Y)("h1",{className:"onboarding-text loading-text",style:{pointerEvents:"none"},children:"Loading Game…"}),(0,u.Y)(c.A,{className:"loading-hub--game loading-hub--left",keyword:"game",minHeight:72,lines:g,ariaLabel:"Loading game"})]})]})};var m=n(9386),g=n(3022),p=n(9619),f=n(6506),b=n(605),y=n(9094),h=n(2316),v=n(9524),E=n(8828),S=n(1426),L=n(7726);const k="game-mode-active",A=({reset:e,startAtFrame:t,onInnerMount:n,label:r,ctaEnabled:o,loadingLines:a})=>(0,u.Y)(d,{startAtFrame:t,onMount:n,label:r,ctaEnabled:o,loadingLines:a},e),M=()=>{const[e,t]=(0,r.useState)(null),[n,a]=(0,r.useState)(null),[l,s]=(0,r.useState)(null),[i,c]=(0,r.useState)(!1),[d,m]=(0,r.useState)(!1),g=(0,r.useRef)(!1),p=(0,r.useRef)(!1),f=(0,r.useRef)(!1),[b,y]=(0,r.useState)(0),h=(0,r.useCallback)(()=>y(e=>e+1),[]),v=(0,r.useMemo)(()=>g.current?0:30,[b]),E=(0,r.useCallback)(()=>{g.current=!0},[]);return(0,r.useEffect)(()=>{const e=document.getElementById("block-game");if(!e)return;t(e);const n=e.querySelector('[data-ssr-shell="block-game"]');if(!n)return;let r=n.querySelector(".block-g-onboarding");r||(r=n,r.classList.add("block-g-onboarding","tooltip-block-g"),r.setAttribute("aria-live","polite"),r.style.display||="flex",r.style.alignItems||="center"),r.replaceChildren(),a(r),s(n)},[]),(0,r.useEffect)(()=>{if(!e)return;const t=function(e,t=2e3){const n=window;if("function"==typeof n.requestIdleCallback){const r=n.requestIdleCallback(e,{timeout:t});return()=>n.cancelIdleCallback?.(r)}const r=window.setTimeout(e,t);return()=>window.clearTimeout(r)}(()=>c(!0),2e3),n=new IntersectionObserver(([e])=>{e.isIntersecting&&(c(!0),t(),n.disconnect())},{threshold:[0,.3]});return n.observe(e),()=>{n.disconnect(),t()}},[e]),(0,r.useEffect)(()=>{if(!e)return;const t=new IntersectionObserver(([t])=>{const n=!!t.isIntersecting;if(!p.current)return p.current=!0,void(f.current=n);const r=f.current;f.current=n,!n||r||e.classList.contains("ingame")||y(e=>e+1)},{threshold:.01});return t.observe(e),()=>t.disconnect()},[e]),e&&n&&l&&i?(0,u.FD)(u.FK,{children:[(0,o.createPortal)((0,u.Y)(A,{reset:b,startAtFrame:v,onInnerMount:E,label:d?"Click Here to Play!":"Loading Game…",ctaEnabled:d}),n),(0,o.createPortal)((0,u.Y)(w,{container:e,onboardingEl:n,reapplyOnboarding:h,isStageReady:d,onStageReady:m}),l)]}):null},w=({container:e,onboardingEl:t,reapplyOnboarding:o,isStageReady:l,onStageReady:s})=>{const i=(0,f.e)(),[c,d]=(0,r.useState)(!1),[A,M]=(0,r.useState)(0),[w,C]=(0,r.useState)(null),F=(0,h.t)(),I="number"==typeof F?F:0,R=(null==w?A:w)>I?null==w?A:w:I,x=null==w&&A>I,[O,Y]=(0,r.useState)(null),[T,D]=(0,r.useState)(!1),[H,q]=(0,r.useState)(!1),N=(0,r.useRef)(null),P=(0,r.useRef)(null),B=(0,r.useCallback)(()=>{l&&(y.nJ.game(),e.classList.add("ingame"),document.body.classList.add(k),d(!0),M(0),C(null),Y("lottie"),t.style.transition="opacity 180ms ease",t.style.opacity="0",window.setTimeout(()=>{t.style.display="none"},180))},[e,t,l]);(0,r.useEffect)(()=>{const e=".coin, .onboarding-text, [data-start-hit]",n=()=>{t.querySelectorAll(e).forEach(e=>{const t=e;t.style.pointerEvents=l?"auto":"none",t.style.cursor=l?"pointer":"default",t.hasAttribute("role")||t.setAttribute("role","button"),t.tabIndex<0&&(t.tabIndex=0)}),t.setAttribute("aria-busy",String(!l))};n();const r=new MutationObserver(n);r.observe(t,{childList:!0,subtree:!0});const o=t=>{if(!l)return;const n=t.target;n&&n.closest(e)&&B()},a=t=>{if(l&&("Enter"===t.key||" "===t.key)){const n=t.target;n&&n.closest(e)&&(t.preventDefault(),B())}};return t.addEventListener("click",o,{passive:!0}),t.addEventListener("keydown",a),()=>{r.disconnect(),t.removeEventListener("click",o),t.removeEventListener("keydown",a)}},[t,B,l]),(0,r.useEffect)(()=>{if("lottie"!==O||!N.current)return;let e,t=!0;return(async()=>{if(e=await a.A.loadAnimation({container:N.current,renderer:"svg",loop:!1,autoplay:!0,animationData:i?S:E}),!t||!e)return;e.addEventListener("complete",()=>Y("begin"))})(),()=>{t=!1,e?.destroy?.()}},[O,i]),(0,r.useEffect)(()=>{if("begin"===O){const e=setTimeout(()=>Y(null),1e3);return()=>clearTimeout(e)}},[O]),(0,r.useEffect)(()=>{if("lottie"===O)D(!0),q(!0);else if(null===O){D(!1);const e=setTimeout(()=>q(!1),400);return()=>clearTimeout(e)}},[O]);const G=e=>{P.current=e,s(!0)};return(0,r.useEffect)(()=>()=>s(!1),[s]),(0,u.FD)(u.FK,{children:[!c&&(0,u.Y)(b.A,{load:()=>n.e(775).then(n.bind(n,1775)),fallback:null,preloadOnIdle:!0,preloadIdleTimeout:2e3,preloadOnFirstIO:!0,rootMargin:"0px",placeholderMinHeight:360,componentProps:{onReady:G,onCoinsChange:e=>M(e),onGameOver:e=>C(e),highScore:I,pauseWhenHidden:!0,demoMode:!0,overlayActive:!1,allowSpawns:!0}}),c&&(0,u.FD)(L.A,{children:[(0,u.Y)(v.A,{active:!0,lockBodyScroll:!0,alsoBlockWheel:!0,alsoBlockTouch:!0,allowWhenTyping:!0}),(0,u.Y)(m.A,{onExit:()=>{d(!1),Y(null),M(0),C(null),document.body.classList.remove(k),e.classList.remove("ingame"),t.style.display="",o(),requestAnimationFrame(()=>{t.style.opacity="1"})}}),(0,u.Y)(g.A,{coins:A,highScore:R,newHighScore:x}),H&&(0,u.Y)("div",{className:"countdown-bg-overlay "+(T?"":"hide"),style:{pointerEvents:"none"}}),("lottie"===O||"begin"===O)&&(0,u.Y)("div",{ref:N,id:"lottie-onboarding",className:"countdown-lottie",style:{pointerEvents:"none"}}),(0,u.Y)(p.A,{score:w,highScore:I,onRestart:()=>{e.classList.add("ingame"),Y(null),M(0),C(null),P.current?.restart()},onHide:()=>C(null)}),(0,u.Y)(b.A,{load:()=>n.e(775).then(n.bind(n,1775)),fallback:null,mountMode:"io",observeTargetId:"game-viewport-root",rootMargin:"0px",enterThreshold:.01,exitThreshold:0,unmountDelayMs:150,preloadOnIdle:!0,preloadIdleTimeout:2e3,preloadOnFirstIO:!0,placeholderMinHeight:360,componentProps:{onReady:G,onCoinsChange:e=>M(e),onGameOver:e=>C(e),highScore:I,pauseWhenHidden:!0,demoMode:!1,overlayActive:"lottie"===O||"begin"===O,allowSpawns:"begin"===O||null===O}})]})]})}}};
//# sourceMappingURL=167.server.js.map