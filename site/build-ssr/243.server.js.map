{"version":3,"file":"243.server.js","mappings":"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","sources":["webpack://personal-site/./src/components/block-type-1/data-visualization.tsx","webpack://personal-site/./src/utils/tooltip/tooltip.ts","webpack://personal-site/./src/utils/tooltip/tooltipInit.ts","webpack://personal-site/./src/utils/media-providers/image-upgrade-manager.ts","webpack://personal-site/./src/utils/media-providers/media-loader.tsx","webpack://personal-site/./src/utils/media-providers/video-observer.tsx","webpack://personal-site/./src/utils/content-utility/color-map.ts","webpack://personal-site/./src/utils/content-utility/real-mobile.ts"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport client from '../../utils/sanity';\r\nimport MediaLoader from '../../utils/media-providers/media-loader';\r\nimport PannableViewport from '../../utils/split+drag/pannable-object-position';\r\nimport { useTooltipInit } from '../../utils/tooltip/tooltipInit';\r\nimport { useSsrData } from '../../utils/context-providers/ssr-data-context';\r\nimport { getHighQualityImageUrl } from '../../utils/media-providers/image-builder';\r\nimport '../../styles/block-type-1.css';\r\n\r\ntype VideoSet = { webmUrl?: string; mp4Url?: string; poster?: any };\r\ntype MediaSlot = { alt?: string; image?: any; video?: VideoSet };\r\ntype DataVizData = { mediaOne: MediaSlot };\r\n\r\nexport default function DataVisualizationBlock() {\r\n  const ssrData = useSsrData();\r\n  const [data, setData] = useState<DataVizData | null>(\r\n    (ssrData?.preloaded?.dataviz as DataVizData) || null\r\n  );\r\n\r\n  useTooltipInit();\r\n\r\n  useEffect(() => {\r\n    if (data) return;\r\n    client\r\n      .fetch<DataVizData>(\r\n        `*[_type == \"mediaBlock\" && slug.current == $slug][0]{\r\n          mediaOne{\r\n            alt,\r\n            image,\r\n            video{\r\n              \"webmUrl\": webm.asset->url,\r\n              \"mp4Url\": mp4.asset->url,\r\n              poster\r\n            }\r\n          }\r\n        }`,\r\n        { slug: 'data-viz' }\r\n      )\r\n      .then(setData)\r\n      .catch((err) => {\r\n        console.warn('[DataVisualizationBlock] GROQ fetch failed:', err);\r\n        setData(null);\r\n      });\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  if (!data?.mediaOne) return null;\r\n\r\n  const { alt = 'Data Visualization', image, video } = data.mediaOne;\r\n  const isVideo = Boolean(video?.webmUrl || video?.mp4Url);\r\n  const highPoster = video?.poster\r\n    ? getHighQualityImageUrl(video.poster, 1920, 1080, 90)\r\n    : undefined;\r\n\r\n  return (\r\n    <section\r\n      className=\"block-type-1\"\r\n      style={{ position: 'relative', width: '100%', height: '100dvh', overflow: 'hidden' }}\r\n    >\r\n      <div\r\n        className=\"media-content\"\r\n        style={{\r\n          width: '100%',\r\n          height: '100%',\r\n          position: 'absolute',\r\n          inset: 0,\r\n        }}\r\n      >\r\n        <PannableViewport sensitivity={2}>\r\n          <MediaLoader\r\n            type={isVideo ? 'video' : 'image'}\r\n            src={isVideo ? (video as VideoSet) : image}\r\n            alt={alt}\r\n            id={isVideo ? 'dataviz-media-video' : 'dataviz-media'}\r\n            {...(highPoster ? { 'data-src-full': highPoster } : {})}\r\n            className=\"tooltip-data-viz\"\r\n            objectPosition=\"center center\"\r\n            style={{ width: '100%', height: '100%' }}\r\n            // priority // uncomment if this is the hero\r\n          />\r\n        </PannableViewport>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n","// utils/tooltip/global-tooltip.ts\r\nimport '../../styles/tooltip.css';\r\nimport { projectColors } from '../content-utility/color-map';\r\n\r\ntype TooltipInfo = { tags: string[]; backgroundColor: string };\r\nconst tooltipDataCache: Record<string, TooltipInfo> = {};\r\n\r\nconst LOCAL_FALLBACK_TAGS: Record<string, string[]> = {\r\n  'block-g': ['#q5.js Canvas', '#Gamification', '#Lottie Animation'],\r\n};\r\n\r\nconst TITLE_BY_KEY: Record<string, string> = {\r\n  'rotary-lamp': 'Rotary Lamp',\r\n  'ice-scoop': 'Ice Cream Scoop',\r\n  'data-viz': 'Data Visualization',\r\n  'block-g': 'Evade the Rock',\r\n  'dynamic': 'Dynamic App',\r\n};\r\n\r\nfunction bgForKey(key: string) {\r\n  const colorInfo = projectColors[TITLE_BY_KEY[key]];\r\n  const alpha = colorInfo?.tooltipAlpha ?? 0.6;\r\n  return colorInfo ? `rgba(${colorInfo.rgb}, ${alpha})` : 'rgba(85,95,90,0.6)';\r\n}\r\n\r\nfunction createTooltipDOM() {\r\n  const el = document.createElement('div');\r\n  el.id = 'custom-global-tooltip';\r\n  el.style.position = 'fixed';\r\n  el.style.pointerEvents = 'none';\r\n  el.style.zIndex = '9999';\r\n  el.style.opacity = '0';\r\n  el.style.visibility = 'hidden';\r\n  el.style.backdropFilter = 'blur(8px)';\r\n  el.style.color = '#fff';\r\n  el.style.transition = 'opacity 0.3s ease, visibility 0.3s ease';\r\n  el.className = 'custom-tooltip-blur';\r\n  const root = document.getElementById('efe-portfolio') || document.body;\r\n  root.appendChild(el);\r\n  return el as HTMLDivElement;\r\n}\r\n\r\nlet tooltipEl: HTMLDivElement | null = null;\r\nlet currentKey = '';\r\nlet hideTimeout: ReturnType<typeof setTimeout> | null = null;\r\n\r\nexport const fetchTooltipDataForKey = async (key: string): Promise<TooltipInfo> => {\r\n  if (tooltipDataCache[key]) return tooltipDataCache[key];\r\n\r\n  const bg = bgForKey(key);\r\n\r\n  // local fallback\r\n  if (LOCAL_FALLBACK_TAGS[key]) {\r\n    const info = { tags: LOCAL_FALLBACK_TAGS[key], backgroundColor: bg };\r\n    tooltipDataCache[key] = info;\r\n    return info;\r\n  }\r\n\r\n  // CMS fetch by slug\r\n  try {\r\n    const client = (await import('../sanity')).default;\r\n    const res = await client.fetch<{ tags?: string[] } | null>(\r\n      `*[_type==\"mediaBlock\" && slug.current == $key][0]{ tags }`,\r\n      { key }\r\n    );\r\n    const info: TooltipInfo = { tags: res?.tags ?? [], backgroundColor: bg };\r\n    tooltipDataCache[key] = info;\r\n    return info;\r\n  } catch {\r\n    const info: TooltipInfo = { tags: [], backgroundColor: bg };\r\n    tooltipDataCache[key] = info;\r\n    return info;\r\n  }\r\n};\r\n\r\nconst showTooltip = () => {\r\n  if (!tooltipEl) return;\r\n  if (hideTimeout) clearTimeout(hideTimeout);\r\n  tooltipEl.style.opacity = '1';\r\n  tooltipEl.style.visibility = 'visible';\r\n  hideTimeout = setTimeout(() => hideTooltip(), 1_500);\r\n};\r\n\r\nconst hideTooltip = () => {\r\n  if (!tooltipEl) return;\r\n  if (hideTimeout) clearTimeout(hideTimeout);\r\n  tooltipEl.style.opacity = '0';\r\n  tooltipEl.style.visibility = 'hidden';\r\n  currentKey = '';\r\n};\r\n\r\nfunction positionTooltip(x: number, y: number) {\r\n  if (!tooltipEl) return;\r\n  const rect = tooltipEl.getBoundingClientRect();\r\n  const padding = 0;\r\n  const vw = window.innerWidth;\r\n  const vh = window.innerHeight;\r\n\r\n  const nearTop = y < rect.height + padding + 20;\r\n  const nearBottom = y + rect.height + padding > vh - 20;\r\n  const nearRight = x + rect.width + padding > vw - 20;\r\n  const nearLeft = x < rect.width + padding + 20;\r\n\r\n  let left: number, top: number;\r\n  if (nearBottom) { top = y - rect.height - padding - 8; left = x - rect.width * 0; }\r\n  else if (nearTop) { top = y + padding - 14; left = x - rect.width * 0; }\r\n  else if (nearRight) { top = y - rect.height / 2; left = x - rect.width - padding - 24; }\r\n  else if (nearLeft) { top = y - rect.height / 2; left = x + padding - 4; }\r\n  else { top = y - rect.height / 1.6; left = x + padding - 2; }\r\n\r\n  left = Math.max(padding, Math.min(left, vw - rect.width - padding));\r\n  top  = Math.max(padding, Math.min(top,  vh - rect.height - padding));\r\n\r\n  tooltipEl.style.left = `${left}px`;\r\n  tooltipEl.style.top  = `${top}px`;\r\n}\r\n\r\nexport function initGlobalTooltip(isRealMobile: boolean) {\r\n  if (tooltipEl) return () => {};\r\n  tooltipEl = createTooltipDOM();\r\n\r\n  let lastMouseX = -1;\r\n  let lastMouseY = -1;\r\n  let ticking = false;\r\n  let scrollCheckTimeout: ReturnType<typeof setTimeout> | null = null;\r\n\r\n  const updateForElement = async (el: Element | null) => {\r\n    if (!(el instanceof HTMLElement)) { hideTooltip(); return; }\r\n    const tooltipClass = [...el.classList].find(c => c.startsWith('tooltip-'));\r\n    if (!tooltipClass) { hideTooltip(); return; }\r\n\r\n    const key = tooltipClass.replace('tooltip-', '');\r\n    if (key !== currentKey) {\r\n      currentKey = key;\r\n      const info = await fetchTooltipDataForKey(key);\r\n\r\n      if (!info.tags.length) { hideTooltip(); return; }\r\n      tooltipEl!.innerHTML = info.tags.map(t => `<p class=\"tooltip-tag\">${t}</p>`).join('');\r\n      tooltipEl!.style.backgroundColor = info.backgroundColor;\r\n      showTooltip();\r\n    } else if (tooltipEl!.style.opacity === '0' || tooltipEl!.style.visibility === 'hidden') {\r\n      showTooltip();\r\n    }\r\n  };\r\n\r\n  const onMouseMove = (e: MouseEvent) => {\r\n    lastMouseX = e.clientX;\r\n    lastMouseY = e.clientY;\r\n    requestAnimationFrame(() => positionTooltip(lastMouseX, lastMouseY));\r\n    updateForElement(e.target as Element);\r\n  };\r\n\r\n  const checkHoveredElementOnScroll = () => {\r\n    const el = document.elementFromPoint(lastMouseX, lastMouseY);\r\n    updateForElement(el);\r\n    requestAnimationFrame(() => positionTooltip(lastMouseX, lastMouseY));\r\n  };\r\n\r\n  const onScroll = () => {\r\n    if (!ticking) {\r\n      window.requestAnimationFrame(() => { checkHoveredElementOnScroll(); ticking = false; });\r\n      ticking = true;\r\n    }\r\n    if (scrollCheckTimeout) clearTimeout(scrollCheckTimeout);\r\n    scrollCheckTimeout = setTimeout(() => {}, 120);\r\n  };\r\n\r\n  const onMouseOut = (e: MouseEvent) => {\r\n    if (!e.relatedTarget) hideTooltip();\r\n  };\r\n\r\n  // only attach scroll observer for non-mobile real viewports\r\n  if (!isRealMobile) window.addEventListener('scroll', onScroll, true);\r\n  document.addEventListener('mousemove', onMouseMove, { passive: true });\r\n  document.addEventListener('mouseout', onMouseOut, { passive: true });\r\n\r\n  return () => {\r\n    if (!tooltipEl) return;\r\n    if (!isRealMobile) window.removeEventListener('scroll', onScroll, true);\r\n    document.removeEventListener('mousemove', onMouseMove);\r\n    document.removeEventListener('mouseout', onMouseOut);\r\n    tooltipEl.remove();\r\n    tooltipEl = null;\r\n    if (hideTimeout) clearTimeout(hideTimeout);\r\n  };\r\n}","// utils/tooltip/tooltipInit.ts\r\nimport { useEffect } from 'react';\r\nimport { initGlobalTooltip } from './tooltip';\r\nimport { useRealMobileViewport } from '../content-utility/real-mobile';\r\n\r\nexport const useTooltipInit = () => {\r\n  const isRealMobile = useRealMobileViewport();\r\n\r\n  useEffect(() => {\r\n    const dispose = initGlobalTooltip(isRealMobile);\r\n    return () => dispose?.();\r\n  }, [isRealMobile]);\r\n};\r\n","// src/utils/image-upgrade-manager.ts\r\nlet totalImages = 0;\r\nlet loadedLowRes = 0;\r\nlet listeners: (() => void)[] = [];\r\nlet upgradeTimeout: ReturnType<typeof setTimeout> | null = null;\r\n\r\nexport const setUpgradeTimeout = (ms: number = 5000) => {\r\n  if (upgradeTimeout) return;\r\n  upgradeTimeout = setTimeout(() => {\r\n    listeners.forEach(fn => fn());\r\n    listeners = [];\r\n  }, ms);\r\n};\r\n\r\nexport const registerImage = () => {\r\n  totalImages++;\r\n  setUpgradeTimeout();\r\n};\r\n\r\nexport const notifyLowResLoaded = () => {\r\n  loadedLowRes++;\r\n  if (loadedLowRes >= totalImages) {\r\n    listeners.forEach(fn => fn());\r\n    listeners = [];\r\n  }\r\n};\r\n\r\nexport const onAllLowResLoaded = (callback: () => void) => {\r\n  listeners.push(callback);\r\n};\r\n","// src/utils/media-providers/media-loader.tsx\r\nimport { useRef, useState, useEffect } from 'react';\r\nimport { useVideoVisibility } from './video-observer';\r\nimport LoadingScreen from '../loading/loading';\r\nimport { SanityImageSource } from '@sanity/image-url/lib/types/types';\r\nimport {\r\n  getLowResImageUrl,\r\n  getMediumImageUrl,\r\n  getHighQualityImageUrl,\r\n  urlFor,\r\n} from './image-builder';\r\nimport {\r\n  registerImage,\r\n  notifyLowResLoaded,\r\n  onAllLowResLoaded,\r\n} from './image-upgrade-manager';\r\n\r\nfunction useNearViewport<T extends Element>(\r\n  ref: React.RefObject<T>,\r\n  { rootMargin = '900px 0px', threshold = 0, once = true } = {}\r\n) {\r\n  const [near, setNear] = useState(false);\r\n  useEffect(() => {\r\n    if (!ref.current || near) return;\r\n    const io = new IntersectionObserver(\r\n      (entries) => {\r\n        if (entries.some((e) => e.isIntersecting)) {\r\n          setNear(true);\r\n          if (once) io.disconnect();\r\n        }\r\n      },\r\n      { rootMargin, threshold }\r\n    );\r\n    io.observe(ref.current);\r\n    return () => io.disconnect();\r\n  }, [ref, near, rootMargin, threshold, once]);\r\n  return near;\r\n}\r\n\r\ntype VideoSetSrc = {\r\n  webmUrl?: string;\r\n  mp4Url?: string;\r\n  poster?: SanityImageSource | string;\r\n};\r\n\r\ntype MediaLoaderProps = {\r\n  type: 'image' | 'video';\r\n  src: string | SanityImageSource | VideoSetSrc | null | undefined;\r\n  alt?: string;\r\n  id?: string;\r\n  className?: string;\r\n  style?: React.CSSProperties;\r\n  objectPosition?: string;\r\n  loop?: boolean;\r\n  muted?: boolean;\r\n  playsInline?: boolean;\r\n  preload?: 'auto' | 'metadata' | 'none';\r\n  enableVisibilityControl?: boolean;\r\n  priority?: boolean;\r\n  controls?: boolean;\r\n};\r\n\r\nconst MediaLoader = ({\r\n  type,\r\n  src,\r\n  alt = '',\r\n  id,\r\n  className = '',\r\n  style = {},\r\n  objectPosition = 'center center',\r\n  loop = true,\r\n  muted = true,\r\n  playsInline = true,\r\n  preload = 'metadata',\r\n  enableVisibilityControl = true,\r\n  priority = false,\r\n  controls = false,\r\n}: MediaLoaderProps) => {\r\n  const isSSR = typeof window === 'undefined';\r\n\r\n  // Start as loaded in SSR to avoid fade-in on hydration\r\n  const [loaded, setLoaded] = useState(isSSR);\r\n  const [showMedium, setShowMedium] = useState(false);\r\n  const [showHigh, setShowHigh] = useState(false);\r\n\r\n  // Native poster control (no overlay)\r\n  const [posterRemoved, setPosterRemoved] = useState(false);\r\n\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const imgRef = useRef<HTMLImageElement>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n  const isNear = useNearViewport(containerRef);\r\n  const shouldStart = priority || isNear;\r\n\r\n  // If already cached, skip fade-in\r\n  useEffect(() => {\r\n    if (type === 'image' && imgRef.current?.complete) setLoaded(true);\r\n    if (type === 'video' && videoRef.current?.readyState >= 2) setLoaded(true);\r\n  }, [type]);\r\n\r\n  // IMAGE progressive upgrade\r\n  useEffect(() => {\r\n    if (type !== 'image') return;\r\n    registerImage();\r\n\r\n    const t1 = setTimeout(() => setShowMedium(true), shouldStart ? 0 : 2000);\r\n    if (shouldStart) setShowMedium(true);\r\n\r\n    const off = () => setTimeout(() => setShowHigh(true), 300);\r\n    onAllLowResLoaded(off);\r\n    const t2 = setTimeout(() => setShowHigh(true), 5000);\r\n\r\n    return () => {\r\n      clearTimeout(t1);\r\n      clearTimeout(t2);\r\n    };\r\n  }, [type, shouldStart]);\r\n\r\n  const onMediaLoaded = () => {\r\n    setLoaded(true);\r\n    if (type === 'image') notifyLowResLoaded();\r\n    if (id) {\r\n      const event = new CustomEvent('mediaReady', { detail: { id } });\r\n      window.dispatchEvent(event);\r\n    }\r\n  };\r\n\r\n  // ----- Video source parsing + poster URL -----\r\n  const isVideoSetObj =\r\n    typeof src === 'object' &&\r\n    src !== null &&\r\n    !('asset' in (src as any)) &&\r\n    (('webmUrl' in (src as any)) || ('mp4Url' in (src as any)));\r\n\r\n  const vs = (isVideoSetObj ? (src as VideoSetSrc) : undefined);\r\n  const legacyVideoUrl = typeof src === 'string' ? src : undefined;\r\n\r\n  const posterUrl =\r\n    vs?.poster\r\n      ? (typeof vs.poster === 'string'\r\n          ? vs.poster\r\n          : urlFor(vs.poster).width(1200).quality(80).auto('format').url())\r\n      : undefined;\r\n\r\n  // ✅ Keep native poster visible until the first *painted* frame, then remove it.\r\n  useEffect(() => {\r\n    if (type !== 'video' || !videoRef.current) return;\r\n    const v = videoRef.current;\r\n\r\n    const hidePoster = () => {\r\n      setPosterRemoved(true);\r\n      v.removeAttribute('poster');\r\n    };\r\n\r\n    const onPlay = () => {\r\n      const anyV = v as any;\r\n      if (typeof anyV.requestVideoFrameCallback === 'function') {\r\n        anyV.requestVideoFrameCallback(() => hidePoster());\r\n      } else {\r\n        const onTime = () => {\r\n          if (v.currentTime > 0 && v.readyState >= 2) {\r\n            v.removeEventListener('timeupdate', onTime);\r\n            hidePoster();\r\n          }\r\n        };\r\n        v.addEventListener('timeupdate', onTime);\r\n        const timer = setTimeout(() => {\r\n          v.removeEventListener('timeupdate', onTime);\r\n          hidePoster();\r\n        }, 1200);\r\n        return () => clearTimeout(timer);\r\n      }\r\n    };\r\n\r\n    v.addEventListener('play', onPlay, { once: true });\r\n    return () => v.removeEventListener('play', onPlay);\r\n  }, [type]);\r\n\r\n  // VIDEO visibility/autoplay (your existing hook takes care of play/pause)\r\n  useVideoVisibility(\r\n    videoRef,\r\n    containerRef,\r\n    type === 'video' && enableVisibilityControl ? 0.35 : (undefined as unknown as number)\r\n  );\r\n\r\n  // ─────────────────────────────────────────────────────────────\r\n  // VIDEO RELIABILITY PATCHES\r\n  // - Kick load when near\r\n  // - Retry once, then promote preload to 'auto'\r\n  // - Decode nudge for iOS Safari after loadedmetadata\r\n  // - Early \"loaded\" on loadedmetadata to remove spinner sooner\r\n  // - Gentle play kick when data is ready (muted+inline)\r\n  // ─────────────────────────────────────────────────────────────\r\n  useEffect(() => {\r\n    if (type !== 'video' || !videoRef.current) return;\r\n    const v = videoRef.current;\r\n\r\n    let retryTimer: number | null = null;\r\n    let promoteTimer: number | null = null;\r\n\r\n    const clearTimers = () => {\r\n      if (retryTimer) { window.clearTimeout(retryTimer); retryTimer = null; }\r\n      if (promoteTimer) { window.clearTimeout(promoteTimer); promoteTimer = null; }\r\n    };\r\n\r\n    // If we’re near (or priority), ensure the browser actually fetches metadata\r\n    const kickLoad = () => {\r\n      try {\r\n        // set the DOM property; the attribute React renders can be different and that's OK\r\n        v.preload = preload ?? 'metadata';\r\n        if (v.preload !== 'none') v.load(); // important: actually trigger the fetch\r\n      } catch {}\r\n    };\r\n\r\n    const nudgeDecode = () => {\r\n      // iOS Safari sometimes stalls after metadata; a tiny seek wakes decode\r\n      try {\r\n        if (v.readyState < 2) return;\r\n        const t = v.currentTime;\r\n        v.currentTime = t > 0 ? t : 0.001;\r\n      } catch {}\r\n    };\r\n\r\n    const tryPlay = async () => {\r\n      if (!enableVisibilityControl) return;\r\n      try {\r\n        if (v.muted && v.playsInline && v.paused && v.readyState >= 2) {\r\n          await v.play().catch(() => {});\r\n        }\r\n      } catch {}\r\n    };\r\n\r\n    const onLoadedMeta = () => {\r\n      // spinner can go away on metadata (poster is still covering until first frame)\r\n      setLoaded(true);\r\n      nudgeDecode();\r\n    };\r\n\r\n    const onLoadedData = () => { setLoaded(true); void tryPlay(); };\r\n    const onCanPlay = () => { setLoaded(true); void tryPlay(); };\r\n\r\n    if (shouldStart) {\r\n      kickLoad();\r\n\r\n      // If nothing after ~2.5s, try load() once more\r\n      retryTimer = window.setTimeout(() => {\r\n        if (v.readyState < 2) kickLoad();\r\n      }, 2500);\r\n\r\n      // Still nothing after ~5s? Promote preload to 'auto'\r\n      promoteTimer = window.setTimeout(() => {\r\n        if (v.readyState < 2) {\r\n          try { v.preload = 'auto'; v.load(); } catch {}\r\n        }\r\n      }, 5000);\r\n    }\r\n\r\n    v.addEventListener('loadedmetadata', onLoadedMeta);\r\n    v.addEventListener('loadeddata', onLoadedData);\r\n    v.addEventListener('canplay', onCanPlay);\r\n\r\n    // Optional: diagnostics for flaky networks\r\n    const onError = (e: Event) => console.warn('Video error', e);\r\n    const onStalled = () => console.warn('Video stalled');\r\n    const onSuspend = () => {/* benign on many browsers */};\r\n    v.addEventListener('error', onError);\r\n    v.addEventListener('stalled', onStalled);\r\n    v.addEventListener('suspend', onSuspend);\r\n\r\n    return () => {\r\n      clearTimers();\r\n      v.removeEventListener('loadedmetadata', onLoadedMeta);\r\n      v.removeEventListener('loadeddata', onLoadedData);\r\n      v.removeEventListener('canplay', onCanPlay);\r\n      v.removeEventListener('error', onError);\r\n      v.removeEventListener('stalled', onStalled);\r\n      v.removeEventListener('suspend', onSuspend);\r\n    };\r\n  }, [\r\n    type,\r\n    shouldStart,\r\n    preload,\r\n    enableVisibilityControl,\r\n    // if any URL changes, re-run the loader watchdog\r\n    isVideoSetObj,\r\n    (vs && vs.webmUrl) || '',\r\n    (vs && vs.mp4Url) || '',\r\n    legacyVideoUrl || '',\r\n  ]);\r\n\r\n  const hasVideoSource = Boolean(vs?.webmUrl || vs?.mp4Url || legacyVideoUrl);\r\n  if (!src || (type === 'video' && !hasVideoSource)) return null;\r\n\r\n  // ====== IMAGE ======\r\n  if (type === 'image') {\r\n    const ultraLowSrc = typeof src === 'string' ? src : getLowResImageUrl(src);\r\n    const mediumSrc   = typeof src === 'string' ? src : getMediumImageUrl(src);\r\n    const highResSrc  = typeof src === 'string' ? src : getHighQualityImageUrl(src);\r\n\r\n    const resolvedSrc = showHigh ? highResSrc : showMedium ? mediumSrc : ultraLowSrc;\r\n    if (!resolvedSrc) return null;\r\n\r\n    return (\r\n      <div ref={containerRef} style={{ position: 'relative', width: '100%', height: '100%' }}>\r\n        {!loaded && (\r\n          <div className=\"absolute-inset\">\r\n            <LoadingScreen isFullScreen={false} />\r\n          </div>\r\n        )}\r\n        <img\r\n          ref={imgRef}\r\n          loading={priority ? 'eager' : undefined}\r\n          fetchPriority={showHigh || priority ? 'high' : showMedium ? 'auto' : 'low'}\r\n          id={id}\r\n          src={resolvedSrc || undefined}\r\n          alt={alt}\r\n          onLoad={onMediaLoaded}\r\n          onError={(e) => console.warn('Image failed', (e.target as HTMLImageElement).src)}\r\n          className={className}\r\n          draggable={false}\r\n          style={{\r\n            ...style,\r\n            objectFit: 'cover',\r\n            objectPosition,\r\n            opacity: loaded ? 1 : 0,\r\n            transition: isSSR ? 'none' : 'filter 0.5s ease, opacity 0.3s ease',\r\n          }}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // ====== VIDEO ======\r\n  const showSpinner = !loaded;\r\n\r\n  return (\r\n    <div ref={containerRef} style={{ position: 'relative', width: '100%', height: '100%' }}>\r\n      {showSpinner && (\r\n        <div className=\"absolute-inset\">\r\n          <LoadingScreen isFullScreen={false} />\r\n        </div>\r\n      )}\r\n\r\n      <video\r\n        id={id}\r\n        ref={videoRef}\r\n        // treat loadeddata & metadata as “ready enough” for UI\r\n        onLoadedData={onMediaLoaded}\r\n        onLoadedMetadata={() => setLoaded(true)}\r\n        onError={(e) => console.warn('Video failed', e)}\r\n        className={className}\r\n        style={{\r\n          ...style,\r\n          objectFit: 'cover',\r\n          objectPosition,\r\n          opacity: loaded ? 1 : 0,\r\n          transition: isSSR ? 'none' : 'opacity 0.3s ease',\r\n          pointerEvents: 'all',\r\n          zIndex: 1,\r\n        }}\r\n        loop={loop}\r\n        muted={muted}\r\n        playsInline={playsInline}\r\n        preload={preload ?? 'metadata'}\r\n        controls={controls}\r\n        // If you host poster/video on different origins and ever read pixels to <canvas>,\r\n        // uncomment next line and ensure CORS headers exist:\r\n        // crossOrigin=\"anonymous\"\r\n        poster={posterRemoved ? undefined : posterUrl}\r\n      >\r\n        {/* Order matters: prefer MP4 first for Safari reliability */}\r\n        {vs?.mp4Url  && <source src={vs.mp4Url  || undefined} type=\"video/mp4\"  />}\r\n        {vs?.webmUrl && <source src={vs.webmUrl || undefined} type=\"video/webm\" />}\r\n        {!vs?.webmUrl && !vs?.mp4Url && legacyVideoUrl && (\r\n          <source src={legacyVideoUrl || undefined} />\r\n        )}\r\n      </video>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MediaLoader;\r\n","// video-observer.tsx\r\nimport { useEffect } from 'react';\r\n\r\nexport const useVideoVisibility = (\r\n  videoRef: React.RefObject<HTMLVideoElement> | null,\r\n  containerRef: React.RefObject<HTMLElement> | null,\r\n  threshold: number = 0.4\r\n) => {\r\n  useEffect(() => {\r\n    if (!videoRef?.current || !containerRef?.current) return;\r\n\r\n    const t = typeof threshold === 'number' && threshold >= 0 && threshold <= 1 ? threshold : 0.4;\r\n\r\n    let observer: IntersectionObserver | undefined;\r\n\r\n    const video = videoRef.current!;\r\n    const container = containerRef.current!;\r\n\r\n    // IMPORTANT: load even when using <source> children\r\n    // (video.src is empty in that case; currentSrc is set after load())\r\n    video.load();\r\n    video.muted = true;\r\n\r\n    observer = new IntersectionObserver(\r\n      ([entry]) => {\r\n        if (entry.isIntersecting) {\r\n          video.play().catch(() => setTimeout(() => video.play().catch(() => {}), 500));\r\n        } else {\r\n          video.pause();\r\n        }\r\n      },\r\n      { threshold: t }\r\n    );\r\n\r\n    observer.observe(container);\r\n\r\n    // kick once if already in view\r\n    const rect = container.getBoundingClientRect();\r\n    const ratio = Math.min(Math.max((window.innerHeight - rect.top) / window.innerHeight, 0), 1);\r\n    if (ratio >= t) video.play().catch(() => {});\r\n\r\n    return () => observer?.disconnect();\r\n  }, [videoRef, containerRef, threshold]);\r\n};\r\n","// Master color config\r\nexport interface ProjectColor {\r\n  rgb: string;         // \"204, 85, 41\"\r\n  tooltipAlpha?: number;\r\n  defaultAlpha?: number;\r\n  darkThemeTop?: string; // optional override for theme-color\r\n}\r\n\r\nexport const projectColors: Record<string, ProjectColor> = {\r\n  'Rotary Lamp': {\r\n    rgb: '204, 85, 41',\r\n    tooltipAlpha: 0.6,\r\n    defaultAlpha: 0.6,\r\n    darkThemeTop: 'rgba(72, 161, 161, 1)'\r\n  },\r\n  'Ice Cream Scoop': {\r\n    rgb: '234, 103, 97',\r\n    tooltipAlpha: 0.6,\r\n    defaultAlpha: 0.6,\r\n    darkThemeTop: 'rgba(23, 27, 24, 1)'\r\n  },\r\n  'Data Visualization': {\r\n    rgb: '153, 199, 7',\r\n    tooltipAlpha: 0.8,\r\n    defaultAlpha: 0.6,\r\n    darkThemeTop: 'rgba(28, 30, 31, 1)'\r\n  },\r\n  'Evade the Rock': {\r\n    rgb: '101, 86, 175',\r\n    tooltipAlpha: 0.6,\r\n    defaultAlpha: 0.6,\r\n    darkThemeTop: 'rgb(25, 25, 25)'\r\n  },\r\n  'Dynamic App': {\r\n    rgb: '120, 211, 255',\r\n    tooltipAlpha: 0.6,\r\n    defaultAlpha: 0.6,\r\n    darkThemeTop: 'rgba(17, 17, 17, 1)'\r\n  }\r\n};\r\n","// useRealMobileViewport.ts\r\nimport { useEffect, useState } from 'react';\r\n\r\nexport function useRealMobileViewport() {\r\n  const [isRealMobile, setIsRealMobile] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const checkMobile = () => {\r\n      const touch = navigator.maxTouchPoints > 0;\r\n      const coarse = window.matchMedia?.('(pointer: coarse)').matches ?? false;\r\n      const width = window.innerWidth;\r\n      const ua = navigator.userAgent || navigator.vendor || (window as any).opera;\r\n\r\n      // iOS detection (iPhone / iPad)\r\n      const isIOS = /iPad|iPhone|iPod/.test(ua) ||\r\n        (navigator.platform === 'MacIntel' && touch); // iPadOS pretends to be Mac\r\n\r\n      // Android detection\r\n      const isAndroid = /Android/.test(ua);\r\n\r\n      // Consider it real mobile if:\r\n      // - Touch exists, and viewport is small, or\r\n      // - Known mobile UA\r\n      const realMobile =\r\n        (touch && width <= 1024) ||\r\n        isIOS ||\r\n        isAndroid ||\r\n        coarse;\r\n\r\n      setIsRealMobile(realMobile);\r\n    };\r\n\r\n    checkMobile();\r\n    window.addEventListener('resize', checkMobile);\r\n    window.addEventListener('orientationchange', checkMobile);\r\n\r\n    return () => {\r\n      window.removeEventListener('resize', checkMobile);\r\n      window.removeEventListener('orientationchange', checkMobile);\r\n    };\r\n  }, []);\r\n\r\n  return isRealMobile;\r\n}\r\n"],"names":["DataVisualizationBlock","ssrData","useSsrData","data","setData","useState","preloaded","dataviz","useTooltipInit","useEffect","client","fetch","slug","then","catch","err","console","warn","mediaOne","alt","image","video","isVideo","Boolean","webmUrl","mp4Url","highPoster","poster","getHighQualityImageUrl","undefined","_jsx","className","style","position","width","height","overflow","children","inset","PannableViewport","sensitivity","MediaLoader","type","src","id","objectPosition","tooltipDataCache","LOCAL_FALLBACK_TAGS","TITLE_BY_KEY","tooltipEl","currentKey","hideTimeout","showTooltip","clearTimeout","opacity","visibility","setTimeout","hideTooltip","positionTooltip","x","y","rect","getBoundingClientRect","vw","window","innerWidth","vh","innerHeight","nearTop","nearBottom","nearRight","nearLeft","left","top","Math","max","min","initGlobalTooltip","isRealMobile","el","document","createElement","pointerEvents","zIndex","backdropFilter","color","transition","getElementById","body","appendChild","createTooltipDOM","lastMouseX","lastMouseY","ticking","scrollCheckTimeout","updateForElement","async","HTMLElement","tooltipClass","classList","find","c","startsWith","key","replace","info","bg","colorInfo","projectColors","alpha","tooltipAlpha","rgb","bgForKey","tags","backgroundColor","default","res","fetchTooltipDataForKey","length","innerHTML","map","t","join","onMouseMove","e","clientX","clientY","requestAnimationFrame","target","onScroll","checkHoveredElementOnScroll","elementFromPoint","onMouseOut","relatedTarget","addEventListener","passive","removeEventListener","remove","useRealMobileViewport","dispose","totalImages","loadedLowRes","listeners","upgradeTimeout","loop","muted","playsInline","preload","enableVisibilityControl","priority","controls","isSSR","loaded","setLoaded","showMedium","setShowMedium","showHigh","setShowHigh","posterRemoved","setPosterRemoved","videoRef","useRef","imgRef","containerRef","isNear","ref","rootMargin","threshold","once","near","setNear","current","io","IntersectionObserver","entries","some","isIntersecting","disconnect","observe","useNearViewport","shouldStart","complete","readyState","setUpgradeTimeout","ms","forEach","fn","t1","callback","off","push","t2","onMediaLoaded","event","CustomEvent","detail","dispatchEvent","isVideoSetObj","vs","legacyVideoUrl","posterUrl","urlFor","quality","auto","url","v","hidePoster","removeAttribute","onPlay","anyV","requestVideoFrameCallback","onTime","currentTime","timer","useVideoVisibility","observer","container","load","entry","play","pause","retryTimer","promoteTimer","kickLoad","tryPlay","paused","onLoadedMeta","nudgeDecode","onLoadedData","onCanPlay","onError","onStalled","onSuspend","hasVideoSource","ultraLowSrc","getLowResImageUrl","mediumSrc","getMediumImageUrl","highResSrc","resolvedSrc","_jsxs","LoadingScreen","isFullScreen","loading","fetchPriority","onLoad","draggable","objectFit","showSpinner","onLoadedMetadata","defaultAlpha","darkThemeTop","setIsRealMobile","checkMobile","touch","navigator","maxTouchPoints","coarse","matchMedia","matches","ua","userAgent","vendor","opera","isIOS","test","platform","isAndroid"],"sourceRoot":""}